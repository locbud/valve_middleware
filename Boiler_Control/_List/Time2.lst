C51 COMPILER V9.59.0.0   TIME2                                                             09/25/2019 14:50:55 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE TIME2
OBJECT MODULE PLACED IN .\_Obj\Time2.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Libraries\Time2.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Sourc
                    -e;..\Libraries) DEFINE(MB_MT=0,Uart1=1,Uart2=0) DEBUG PRINT(..\_List\Time2.lst) OBJECT(.\_Obj\Time2.obj)

line level    source

   1          //--------------------------------------------------------------------------
   2          //
   3          //
   4          //
   5          //--------------------------------------------------------------------------
   6          #include <string.h>
   7          #include "REG_MG82FG5Bxx.h"
   8          #include "Define.h"
   9          #include "Time2.h"
  10          #include "Uart.h"
  11          //--------------------------------------------------------------------------
  12          bit FG_T10mS = 0;
  13          bit FG_T100mS = 0;
  14          bit FG_T1S = 0;
  15          //
  16          idata unsigned char T_10mS = 0;
  17          idata unsigned char T_100m = 0;
  18          idata unsigned char  T_Sec  = 0;
  19          //
  20          idata unsigned int  D_10m  = 0;
  21          idata unsigned int  D_100m  = 0;
  22          idata unsigned int  D_1Sec  = 0;
  23          //
  24          #if(Uart1)
  25                  idata unsigned char Tx1_InCNT = 0;
  26          #endif
  27          #if(Uart2)
                      idata unsigned char Tx2_InCNT = 0;
              #endif
  30          //
  31          idata unsigned int T_delay = 0;
  32          
  33          //--------------------------------------------------------------------------
  34          void delay(unsigned int t)
  35          {          
  36   1          T_delay=0;
  37   1          while(T_delay<t);
  38   1      }
  39          //--------------------------------------------------------------------------
  40          void Initial_Timer2(void)
  41          {
  42   1              WTYPE   WD;
  43   1              T2CON = 0x00;
  44   1              T2MOD = 0x00;
  45   1              PCON0 |= 0x80;
  46   1              WD.W = (unsigned int)(0x10000-((Xtal_Freq/12)/T2_Tg_Val));
  47   1              RCAP2H = WD.B[0];
  48   1              RCAP2L = WD.B[1];
  49   1              TF2  = 0;
  50   1              TR2  = 1;                                                       // timer 2 double
  51   1              PT2L  = 1;
  52   1              ET2  = 1;
  53   1      }
  54          //--------------------------------------------------------------------------
C51 COMPILER V9.59.0.0   TIME2                                                             09/25/2019 14:50:55 PAGE 2   

  55          // 타이머 인터럽트 1mSec 마다 timer_cnt 증가
  56          void Ref_Timer(void) interrupt 5 using 2
  57          {
  58   1              idata unsigned char c = 0;
  59   1              idata unsigned char  bkSFRPI = 0;
  60   1              //---
  61   1              TF2 = 0;
  62   1          T_delay++;
  63   1          //--- 
  64   1      #if(Uart1)
  65   1          if(Tx1_FG){
  66   2              Tx1_InCNT++;
  67   2              if(Tx1_InCNT >= Tx1_Interval){
  68   3                  Tx1_InCNT = 0;
  69   3                  if(Tx1_CNT < Tx1_Len){
  70   4                              c = Tx1_Buf[Tx1_CNT];
  71   4                                      bkSFRPI = SFRPI;
  72   4                                      SFRPI = 0x00;
  73   4                              S0BUF = c;
  74   4                                      SFRPI = bkSFRPI;
  75   4                                      Tx1_CNT++;
  76   4                      } else {
  77   4                              Tx1_FG = 0;
  78   4      //                      DIR0 = 0;
  79   4                      }
  80   3              }
  81   2          }
  82   1              //---
  83   1          if(Rx1_FG){
  84   2              Rx1_Time++;
  85   2              if(Rx1_Time > 6){       // 6mSec
  86   3                      Rx1_FG = 0;
  87   3                              Rx1_tCNT = Rx1_CNT;
  88   3                              memcpy(Rx1_tBuf, Rx1_Buf, Rx1_tCNT);
  89   3                      Rx1_CP = 1;
  90   3              }
  91   2          }
  92   1      #endif
  93   1          //---
  94   1      #if(Uart2)
                  if(Tx2_FG){
                      Tx2_InCNT++;
                      if(Tx2_InCNT >= Tx2_Interval){
                          Tx2_InCNT = 0;
                                      if(Tx2_CNT < Tx2_Len){
                                              c = Tx2_Buf[Tx2_CNT];
                                              bkSFRPI = SFRPI;
                                              SFRPI = 0x01;
                                              S1BUF = c;
                                              SFRPI = bkSFRPI;
                                              Tx2_CNT++;
                                      } else {
                                              Tx2_FG = 0;
              //                              DIR1 = 0;
                                      }
                              }
                  }
                      //---
                  if(Rx2_FG){
                      Rx2_Time++;
                      if(Rx2_Time > 6){
                              Rx2_FG = 0;
C51 COMPILER V9.59.0.0   TIME2                                                             09/25/2019 14:50:55 PAGE 3   

                                      Rx2_tCNT = Rx2_CNT;
                                      memcpy(Rx2_tBuf, Rx2_Buf, Rx2_tCNT);
                              Rx2_CP = 1;
                      }
                  }
              #endif
 123   1          //---
 124   1          T_10mS++;
 125   1              if(T_10mS >= 10){
 126   2                      T_10mS = 0;
 127   2                      D_10m--;
 128   2                      FG_T10mS = 1;
 129   2                      T_100m++;
 130   2                      if(T_100m >= 10){
 131   3                              T_100m = 0;
 132   3                              D_100m--;
 133   3                              FG_T100mS = 1;
 134   3                              T_Sec++;
 135   3                              if(T_Sec >= 10){
 136   4                                      T_Sec = 0;
 137   4                                      D_1Sec--;
 138   4                                      FG_T1S = 1;
 139   4                              }
 140   3                      }
 141   2              }
 142   1      }
 143          //--------------------------------------------------------------------------
 144          // End of File


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    286    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     12       2
   BIT SIZE         =      3    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
